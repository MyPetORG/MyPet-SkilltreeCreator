<div *ngIf="selectedSkilltree$ | async as skilltree">
  <sat-popover #durationPopover xAlign="after" yAlign="center" hasBackdrop>
    <mat-card>
      <mat-card-content>
        <p>The duration the beacon buffs will last.<br>
          Format: [+-=][number]<br>
          Examples:<br>
          +5<br>
          -13<br>
          =1
        </p>
      </mat-card-content>
    </mat-card>
  </sat-popover>
  <sat-popover #rangePopover xAlign="after" yAlign="center" hasBackdrop>
    <mat-card>
      <mat-card-content>
        <p>The range the beacon buffs will be distributed.<br>
          Format: [+-=][number]<br>
          Examples:<br>
          +5<br>
          -13<br>
          =1
        </p>
      </mat-card-content>
    </mat-card>
  </sat-popover>
  <sat-popover #countPopover xAlign="after" yAlign="center" hasBackdrop>
    <mat-card>
      <mat-card-content>
        <p>The amount of buffs the owner of the pet can select at once.<br>
          Format: [+-=][number]<br>
          Examples:<br>
          +5<br>
          -13<br>
          =1
        </p>
      </mat-card-content>
    </mat-card>
  </sat-popover>

  <mat-accordion>
    <mat-expansion-panel *ngFor="let upgrade of skilltree.skills.Beacon; trackBy: trackById; let i = index"
                         [expanded]="selectedUpgrade == i" (opened)="selectedUpgrade = i">
      <mat-expansion-panel-header>{{LevelRule.toString(upgrade.rule)}}</mat-expansion-panel-header>
      <div fxLayout="column">
        <mat-card>
          <mat-input-container>
            <input matInput placeholder="Buff Range" [value]="upgrade.range ? upgrade.range : 0" type="text"
                   pattern="[+-=][0-9]+(\.[0-9]+)?"
                   (blur)="update(skilltree, upgrade, 'range', $event.srcElement.value)">
            <span matSuffix>meters</span>
          </mat-input-container>
          <button mat-icon-button [satPopoverAnchorFor]="rangePopover" (click)="rangePopover.toggle()">
            <mat-icon svgIcon="info_outline">info_outline</mat-icon>
          </button>
        </mat-card>
        <mat-card>
          <mat-input-container>
            <input matInput placeholder="Duration" [value]="upgrade.duration ? upgrade.duration : 0" type="text"
                   pattern="[+-=][0-9]+"
                   (blur)="update(skilltree, upgrade, 'duration', $event.srcElement.value)">
            <span matSuffix>sec</span>
          </mat-input-container>
          <button mat-icon-button [satPopoverAnchorFor]="durationPopover" (click)="durationPopover.toggle()">
            <mat-icon svgIcon="info_outline">info_outline</mat-icon>
          </button>
        </mat-card>
        <mat-card>
          <mat-input-container>
            <input matInput placeholder="Buff Count" [value]="upgrade.count ? upgrade.count : 0" type="text"
                   pattern="[+-=][0-9]+(\.[0-9]+)?"
                   (blur)="update(skilltree, upgrade, 'count', $event.srcElement.value)">
            <span matSuffix>buffs</span>
          </mat-input-container>
          <button mat-icon-button [satPopoverAnchorFor]="countPopover" (click)="countPopover.toggle()">
            <mat-icon svgIcon="info_outline">info_outline</mat-icon>
          </button>
        </mat-card>
        <mat-card>
          <mat-list>
            <h3 mat-subheader>Buffs</h3>
            <mat-list-item>
              <img mat-list-avatar class="skill-icon" src="assets/img/skills/beacon/absorption.png">
              <span mat-line style="overflow: unset !important;">
                  Absorbtion
                <mat-input-container>
                  <input matInput placeholder="Level" [value]="upgrade.buffs.Absorption" type="text"
                         pattern="[+-=][0-9]+"
                         (blur)="updateBuff(skilltree, upgrade, 'Absorption', $event.value)">
                </mat-input-container>
            </span>
            </mat-list-item>
            <mat-list-item>
              <img mat-list-avatar class="skill-icon" src="assets/img/skills/beacon/fireresistance.png">
              <span mat-line>
                  Fire Resistance
                <mat-input-container>
                  <input matInput placeholder="Level" [value]="upgrade.buffs.FireResistance" type="text"
                         pattern="[+-=][0-9]+"
                         (blur)="updateBuff(skilltree, upgrade, 'FireResistance', $event.value)">
                </mat-input-container>
        </span>
            </mat-list-item>
            <mat-list-item>
              <img mat-list-avatar class="skill-icon" src="assets/img/skills/beacon/haste.png">
              <span mat-line>
                  Haste
                <mat-input-container>
                  <input matInput placeholder="Level" [value]="upgrade.buffs.Haste" type="text"
                         pattern="[+-=][0-9]+"
                         (blur)="updateBuff(skilltree, upgrade, 'Haste', $event.value)">
                </mat-input-container>
              </span>
            </mat-list-item>
            <mat-list-item>
              <img mat-list-avatar class="skill-icon" src="assets/img/skills/beacon/healthboost_2.png">
              <span mat-line>
                  Health Boost
                <mat-input-container>
                  <input matInput placeholder="Level" [value]="upgrade.buffs.HealthBoost" type="text"
                         pattern="[+-=][0-9]+"
                         (blur)="updateBuff(skilltree, upgrade, 'HealthBoost', $event.value)">
                </mat-input-container>
              </span>
            </mat-list-item>
            <mat-list-item>
              <img mat-list-avatar class="skill-icon" src="assets/img/skills/beacon/jumpboost.png">
              <span mat-line>
                  Jump Boost
                <mat-input-container>
                  <input matInput placeholder="Level" [value]="upgrade.buffs.JumpBoost" type="text"
                         pattern="[+-=][0-9]+"
                         (blur)="updateBuff(skilltree, upgrade, 'JumpBoost', $event.value)">
                </mat-input-container>
              </span>
            </mat-list-item>
            <mat-list-item>
              <img mat-list-avatar class="skill-icon" src="assets/img/skills/beacon/luck.png">
              <span mat-line>
                <mat-checkbox [checked]="upgrade.buffs.Luck == true"
                              [indeterminate]="upgrade.buffs.Luck == null"
                              (click)="toggleBuff(skilltree, upgrade, 'Luck')">
                  Luck
                </mat-checkbox>
              </span>
            </mat-list-item>
            <mat-list-item>
              <img mat-list-avatar class="skill-icon" src="assets/img/skills/beacon/nightvision.png">
              <span mat-line>
                <mat-checkbox [checked]="upgrade.buffs.NightVision == true"
                              [indeterminate]="upgrade.buffs.NightVision == null"
                              (click)="toggleBuff(skilltree, upgrade, 'NightVision')">
                  Night Vision
                </mat-checkbox>
              </span>
            </mat-list-item>
            <mat-list-item>
              <img mat-list-avatar class="skill-icon" src="assets/img/skills/beacon/resistance.png">
              <span mat-line>
                  Resistance
                <mat-input-container>
                  <input matInput placeholder="Level" [value]="upgrade.buffs.Resistance" type="text"
                         pattern="[+-=][0-9]+"
                         (blur)="updateBuff(skilltree, upgrade, 'Resistance', $event.value)">
                </mat-input-container>
              </span>
            </mat-list-item>
            <mat-list-item>
              <img mat-list-avatar class="skill-icon" src="assets/img/skills/beacon/speed.png">
              <span mat-line>
                  Speed
                <mat-input-container>
                  <input matInput placeholder="Level" [value]="upgrade.buffs.Speed" type="text"
                         pattern="[+-=][0-9]+"
                         (blur)="updateBuff(skilltree, upgrade, 'Speed', $event.value)">
                </mat-input-container>
             </span>
            </mat-list-item>
            <mat-list-item>
              <img mat-list-avatar class="skill-icon" src="assets/img/skills/beacon/strength.png">
              <span mat-line>
                  Strength
                <mat-input-container>
                  <input matInput placeholder="Level" [value]="upgrade.buffs.Strength" type="text"
                         pattern="[+-=][0-9]+"
                         (blur)="updateBuff(skilltree, upgrade, 'Strength', $event.value)">
                </mat-input-container>
             </span>
            </mat-list-item>
            <mat-list-item>
              <img mat-list-avatar class="skill-icon" src="assets/img/skills/beacon/waterbreathing.png">
              <span mat-line>
                <mat-checkbox [checked]="upgrade.buffs.WaterBreathing == true"
                              [indeterminate]="upgrade.buffs.WaterBreathing == null"
                              (click)="toggleBuff(skilltree, upgrade, 'WaterBreathing')">
                  Water Breathing
                </mat-checkbox>
              </span>
            </mat-list-item>
          </mat-list>
        </mat-card>
      </div>
      <mat-action-row>
        <button mat-raised-button color="primary" (click)="deleteRule(skilltree, upgrade)">
          <mat-icon svgIcon="delete">delete</mat-icon>
          Delete
        </button>
      </mat-action-row>
    </mat-expansion-panel>
  </mat-accordion>
</div>
